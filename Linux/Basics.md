#### Типы файлов

Все объекты в Linux являются файлами. Существуют следующие типы файлов:

- Обычные файлы **-  
    **Символьные и двоичные данные (текст, картинки, программы и др.)
    
- Каталог (директория) **d  
    **Список ссылок на файлы или другие каталоги
    
- Символьные ссылки **l  
    **Ссылки на другие файлы по имени
    
- Блочные устройства **b,** символьные устройства **c  
    **Интерфейсы для взаимодействия с аппаратным обеспечением (диски, терминалы, клавиатуры, принтеры и др.). Когда происходит обращение к файлу устройства, ядро операционной системы передает запрос драйверу этого устройства
    
- Сокеты **s** и каналы **p**  
    Интерфейсы для взаимодействия процессов


- /bin (binaries) – исполняемые файлы самых необходимых утилит. Может быть символьной ссылкой на /usr/bin
    
- /boot – файлы, необходимые для самого первого этапа загрузки – загрузки ядра (и обычно само ядро)
    
- /dev (devices) – блочные и символьные файлы устройств (диски, терминалы, клавиатуры, принтеры и др.)
    
- /etc (etcetera) – конфигурационные файлы системы и различных программ
    
- /home – домашние каталоги пользователей для хранения «личных» файлов
    
- /lib (libraries) – файлы библиотек (стандартных функций, необходимых многим программам), необходимых для работы утилит. Может быть символьной ссылкой на /usr/bin
    
- /mnt (mount) – каталог для подключения файловых систем (съемных носителей и др.)
    
- /opt (optional) – каталог для дополнительных программ (проприетарных драйверов, агентов мониторинга и др.)
    
- /proc (process) – файлы в оперативной памяти, в которых содержится информация о выполняемых в системе процессах
    
- /root – домашний каталог пользователя root
    
- /sbin (system binaries) – файлы системных утилит, необходимые для загрузки, резервного копирования и восстановления системы. Может быть символьной ссылкой на /usr/sbin
    
- /sys (system) – виртуальная файловая система sysfs, которая содержит информацию об аппаратном обеспечении (ЦПУ, ОЗУ, дисках, сетевых устройствах), драйверах, ядре системы и др.
    
- /tmp – каталог для временных файлов, обычно зачищается при каждой загрузке системы
    
- /usr – пользовательский каталог, который содержит каталоги исполняемых файлов и конфигурационных файлов
    
- /var (variable) – файлы, создаваемые или используемые различными программами (логи, очереди, идентификаторы процессов, БД и др.)

```
# права доступа
chown <user> <dir> # установить пользователя владельцем каталога
chown <user>:<group> <dir> # установить владельца и группу владельца каталога
chmod 644 <file> # установить права доступа rw- r-- r-- (чтение и запись для владельца, чтение для группы владельца, чтение для остальных пользователей)
сhmod 740 <file> # установить права доступа rwx r-- --- (чтение, запись и исполнение для владельца, чтение для группы владельца)
chmod u+w <file> # добавить владельцу право на запись файла
```

Процесс может находиться в следующих статусах:

- Выполнение (**R**, Running)  
    Выполнение или ожидание ЦПУ для выполнения
    
- Сон (**S**, Sleep)  
    Прерываемое программно ожидание
    
- Непрерываемый сон (**D**, Direct)  
    Ожидание «прямого» сигнала от аппаратной части для прерывания
    
- Приостановлен (**T**, Tracing)  
    Отладка
    
- Зомби (**Z**, Zombie)  
    Выполнение завершено, однако ресурсы не освобождены

```
sudo ps aux
sudo kill -9 <pid> # убийство процесса по PID
sudo killall -s 9 <name> # убийство всех процессов по имени

# утилиты для мониторинга использования ресурсов
htop # использование ресурсов по процессам (может потребоваться установка пакета htop)
nmon # использование процессора по ядрам, памяти, дисков и др. (может потребоваться установка пакета nmon)
iostat # использование процессора в среднем по ядрам и чтение/запись по дискам

# ЦПУ
lscpu # общая информация
cat /proc/cpuinfo # подробная информация

# ОЗУ
cat /proc/meminfo # общая информация и потребление
free -h # удобное представление на основе данных из файла meminfo
ps aux --sort -rss # использование памяти по процессам

# диски
lsblk # общая информация
df -h # просмотр занятного места по разделам
du -сh <dir> # просмотр занятого места в каталоге

# сеть
/sys/class/net/<interface>/speed # просмотр максимальной скорости интерфейса
```

SystemD – это программный комплекс, состоящий из системных компонентов Linux. Основным компонентом является система инициализации системы SystemD, которая пришла на смену SystemV в большинстве современных дистрибутивов. Ядро Linux запускает процесс systemd, который, в свою очередь, запускает все остальные процессы системы.

SystemD предоставляет следующий функционал:

- Запуск служб при старте системы (по возможности параллельно) по различным таргетам (target, аналог уровней загрузки в SystemV)  
    Обеспечивается обратная совместимость с системами инициализации SystemV и LSB
    
- Контроль состояния запущенных служб
    
- Управление устройствами, входом в систему, сетевыми подключениями, ведение журнала событий
    
- Интерфейсы для реализации функциональных возможностей ядра – cgroups, autofs, kdbus
    
- Набор утилит для управления системой – systemctl, journalctl и др.
    
### Что такое systemd unit?

SystemD Unit – это обычный текстовый файл в стиле ini, который декларативно описывает информацию о службах .service, устройствах .device, целях запуска .target и других типах модулей systemd.

Описание юнита состоих из нескольких секций:

- Unit  
    Description (краткое описание), After (ожидание запуска), Requires (обязательная зависимость) и др.
    
- Service  
    Type (тип) – по умолчанию Simple, ExecStart (команда для запуска), ExecStop (команда для остановки) и др.
    
- Install  
    WantedBy (таргет или уровень запуска, на котором юнит должен запуститься)
    

Файлы systemd unit располагаются в следующих каталогах:

- /etc/systemd/system – юниты, создаваемые администраторами
    
- /usr/lib/systemd/system – юниты из установленых пакетов
    
- /run/systemd/system – юниты, создаваемые во время работы системы (в runtime)
```
# просмотр юнитов
systemctl # список юнитов (это псевдоним команды systemctl list-units)
systemctl --type=service # юниты типа сервисы
systemct | grep <keyword> # юниты, содержащие ключевое слово (полезно для быстрого поиска)
systemctl cat <unit> # описание юнита

# управление юнитами
systemctl status <unit> # статус (состояние) юнита
sudo systemctl daemon-reload # перезагрузка конфигурационных файлов в systemd
sudo systemctl enable <unit> # включение сервиса в автозагрузку
sudo systemctl disable <unit> # отключение сервиса из автозагрузки
sudo systemctl start <unit> # запуск
sudo systemctl stop <unit> # остановка

# журналы логов
journalctl -u <unit> # чтение логов по юниту
journalctl -u <unit> --since today # чтение логов по юниту со смены дня 
```

```
# просмотр сетевых настроек сервера
ip a # IP адреса
ip n # ARP таблица
cat /etc/resolv.conf # конфигурация DNS
sudo netstat -tulpn # открытые порты
sudo ss -tulpn # открытые порты (молодежный вариант)

# диагностика сетевых проблем
nslookup <hostname> # проверка разрешения DNS имени
ping <host> # отправка ICMP пакетов до хоста
traceroute <host> # трассировка до хоста UDP пакетами
telnet <host> <port> # проверка доступности TCP порта на хосте
nmap <host> # сетевое сканирование хоста
nmap -p T:<port> <host> # проверка доступности TCP порта на хосте (молодежный вариант)
nmap -p U:<port> <host> # проверка доступности UDP порта на хосте (молодежный вариант)
```
